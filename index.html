<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Offer Router</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
  </style>
</head>
<body>

<h2>Redirecting to best offer...</h2>

<script>
/* ================= SETTINGS ================= */

// তোমার offer গুলো এখানে add করো
const OFFERS = [
  "https://example.com/offerA",
  "https://example.com/offerB",
  "https://example.com/offerC"
];

// কত ms পরে redirect হবে
const REDIRECT_DELAY = 500;

// সব offer শেষ হলে কী করবে
// "stop" | "repeat" | "thankyou"
const END_MODE = "stop";
const THANK_YOU_PAGE = "https://google.com";

/* ============== CORE LOGIC ================= */

function getOfferIndex() {
  let index = localStorage.getItem("offer_index");
  if (index === null) {
    index = 0;
    localStorage.setItem("offer_index", index);
  }
  return parseInt(index, 10);
}

function setOfferIndex(i) {
  localStorage.setItem("offer_index", i);
}

function getNextOffer() {
  let index = getOfferIndex();

  if (index >= OFFERS.length) {
    if (END_MODE === "repeat") {
      setOfferIndex(0);
      return OFFERS[0];
    }
    if (END_MODE === "thankyou") {
      return THANK_YOU_PAGE;
    }
    return null; // stop
  }

  return OFFERS[index];
}

function goToOffer() {
  const offerUrl = getNextOffer();

  if (!offerUrl) {
    document.body.innerHTML = "<h2>No more offers</h2>";
    return;
  }

  setTimeout(() => {
    window.location.replace(offerUrl);
  }, REDIRECT_DELAY);
}

/* ============== BACK BUTTON HANDLING ============== */

// history trap
history.pushState({ page: "router" }, "", location.href);

// initial redirect
goToOffer();

// back button detect
window.addEventListener("popstate", function () {
  let index = getOfferIndex();
  setOfferIndex(index + 1);

  history.pushState({ page: "router" }, "", location.href);
  goToOffer();
});

</script>

</body>
</html>
