<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Offer Router</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
<h2>Redirecting...</h2>

<script>
/* ========= SETTINGS ========= */

const OFFERS = [
  "https://example.com/offerA",
  "https://example.com/offerB",
  "https://example.com/offerC"
];

const REDIRECT_DELAY = 300;

/* ========= STATE ========= */

function getIndex() {
  let i = localStorage.getItem("offer_index");
  if (i === null) {
    i = 0;
    localStorage.setItem("offer_index", i);
  }
  return parseInt(i, 10);
}

function nextIndex() {
  let i = getIndex() + 1;
  localStorage.setItem("offer_index", i);
}

/* ========= REDIRECT ========= */

function goOffer() {
  const i = getIndex();
  if (i >= OFFERS.length) {
    document.body.innerHTML = "<h2>No more offers</h2>";
    return;
  }

  setTimeout(() => {
    // ⚠️ IMPORTANT: href, NOT replace
    window.location.href = OFFERS[i];
  }, REDIRECT_DELAY);
}

/* ========= HISTORY SETUP ========= */

// website history ensure
history.pushState({ page: "router" }, "", location.href);

// first redirect
goOffer();

/* ========= BACK BUTTON ========= */

window.addEventListener("popstate", function () {
  nextIndex(); // move to next offer

  history.pushState({ page: "router" }, "", location.href);
  goOffer();
});
</script>

</body>
</html>
