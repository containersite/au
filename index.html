<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Offer Step Router</title>
</head>
<body>
<h3>Loading next offer...</h3>

<script>
/* ========= CONFIG ========= */

const OFFERS = [
  "https://offerA.com",
  "https://offerB.com",
  "https://offerC.com"
];

const CLICK_CODE = "wen25tvh";
const DELAY = 300;

/* ========= URL PARAMS ========= */

const url = new URL(window.location.href);
const step = parseInt(url.searchParams.get("step") || "0", 10);
const domain = url.searchParams.get("domain");
const z = url.searchParams.get("z");

/* ========= VALIDATION ========= */

if (!domain || !z) {
  document.body.innerHTML = "Missing domain or z";
  throw new Error("Invalid URL");
}

if (step >= OFFERS.length) {
  document.body.innerHTML = "<h2>No more offers</h2>";
  throw new Error("Finished");
}

/* ========= INTERNAL NEXT STEP ========= */

// VERY IMPORTANT:
// before leaving to external site,
// we FIRST create the NEXT internal page in history
url.searchParams.set("step", step + 1);
history.replaceState({}, "", url.toString());

/* ========= BUILD OFFER URL ========= */

const offerUrl = `https://${domain}/${CLICK_CODE}/${z}`;

/* ========= REDIRECT ========= */

setTimeout(() => {
  // href keeps history
  window.location.href = offerUrl;
}, DELAY);
</script>

</body>
</html>
